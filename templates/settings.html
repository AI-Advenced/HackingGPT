{% extends "base.html" %}

{% block title %}Settings - HackingGPT{% endblock %}

{% block head %}
<style>
    .settings-nav {
        background: var(--bg-secondary);
        border-right: 1px solid var(--border-color);
        position: sticky;
        top: 0;
        height: 100vh;
        overflow-y: auto;
    }
    
    .settings-nav-item {
        padding: 1rem;
        cursor: pointer;
        transition: all 0.2s ease;
        border-left: 3px solid transparent;
    }
    
    .settings-nav-item:hover {
        background: var(--bg-tertiary);
        border-left-color: var(--accent-blue);
    }
    
    .settings-nav-item.active {
        background: var(--bg-tertiary);
        border-left-color: var(--accent-blue);
        color: var(--accent-blue);
    }
    
    .settings-content {
        min-height: 100vh;
        padding: 2rem;
    }
    
    .settings-section {
        display: none;
    }
    
    .settings-section.active {
        display: block;
        animation: fadeIn 0.3s ease-in-out;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .setting-item {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 0.5rem;
        padding: 1.5rem;
        margin-bottom: 1rem;
        transition: all 0.2s ease;
    }
    
    .setting-item:hover {
        border-color: var(--accent-blue);
        box-shadow: 0 4px 12px rgba(0, 212, 255, 0.1);
    }
    
    .toggle-switch {
        position: relative;
        width: 60px;
        height: 30px;
        background: #374151;
        border-radius: 15px;
        cursor: pointer;
        transition: background 0.3s ease;
    }
    
    .toggle-switch.active {
        background: var(--accent-blue);
    }
    
    .toggle-switch::before {
        content: '';
        position: absolute;
        top: 3px;
        left: 3px;
        width: 24px;
        height: 24px;
        background: white;
        border-radius: 50%;
        transition: transform 0.3s ease;
    }
    
    .toggle-switch.active::before {
        transform: translateX(30px);
    }
    
    .color-picker {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 0.5rem;
        margin-top: 1rem;
    }
    
    .color-option {
        width: 40px;
        height: 40px;
        border-radius: 0.5rem;
        cursor: pointer;
        border: 2px solid transparent;
        transition: all 0.2s ease;
    }
    
    .color-option:hover,
    .color-option.selected {
        border-color: white;
        transform: scale(1.1);
    }
    
    .api-key-input {
        position: relative;
    }
    
    .api-key-toggle {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
        color: #6b7280;
    }
    
    .api-key-toggle:hover {
        color: #ffffff;
    }
    
    .danger-zone {
        border: 2px solid #ef4444;
        background: rgba(239, 68, 68, 0.1);
        border-radius: 0.75rem;
        padding: 2rem;
        margin-top: 2rem;
    }
    
    .export-import-area {
        background: var(--bg-tertiary);
        border: 2px dashed var(--border-color);
        border-radius: 0.75rem;
        padding: 2rem;
        text-align: center;
        transition: all 0.2s ease;
    }
    
    .export-import-area:hover {
        border-color: var(--accent-blue);
        background: rgba(0, 212, 255, 0.1);
    }
    
    .backup-item {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 0.5rem;
        padding: 1rem;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: between;
    }
    
    .quota-usage {
        background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
        border: 1px solid var(--border-color);
        border-radius: 0.75rem;
        padding: 1.5rem;
        position: relative;
        overflow: hidden;
    }
    
    .quota-usage::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--accent-blue), var(--accent-green));
    }
    
    .security-log-item {
        background: var(--bg-secondary);
        border-left: 4px solid var(--accent-blue);
        padding: 1rem;
        margin-bottom: 0.5rem;
        border-radius: 0 0.5rem 0.5rem 0;
    }
    
    .security-log-item.warning {
        border-left-color: var(--accent-yellow);
    }
    
    .security-log-item.error {
        border-left-color: #ef4444;
    }
    
    .model-selector {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
    }
    
    .model-card {
        background: var(--bg-secondary);
        border: 2px solid var(--border-color);
        border-radius: 0.75rem;
        padding: 1.5rem;
        cursor: pointer;
        transition: all 0.2s ease;
        position: relative;
    }
    
    .model-card:hover {
        border-color: var(--accent-blue);
        transform: translateY(-2px);
    }
    
    .model-card.selected {
        border-color: var(--accent-green);
        background: rgba(0, 255, 136, 0.1);
    }
    
    .model-card.selected::before {
        content: 'âœ“';
        position: absolute;
        top: 1rem;
        right: 1rem;
        color: var(--accent-green);
        font-weight: bold;
        font-size: 1.2rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="flex">
    <!-- Settings Navigation -->
    <div class="w-80 settings-nav">
        <div class="p-6">
            <h2 class="text-xl font-bold mb-6">
                <i class="fas fa-cog mr-2" style="color: var(--accent-blue);"></i>
                Settings
            </h2>
            
            <nav class="space-y-1">
                <div class="settings-nav-item active" onclick="showSection('general')">
                    <i class="fas fa-user mr-3"></i>
                    General
                </div>
                <div class="settings-nav-item" onclick="showSection('ai-models')">
                    <i class="fas fa-robot mr-3"></i>
                    AI Models
                </div>
                <div class="settings-nav-item" onclick="showSection('appearance')">
                    <i class="fas fa-palette mr-3"></i>
                    Appearance
                </div>
                <div class="settings-nav-item" onclick="showSection('security')">
                    <i class="fas fa-shield-alt mr-3"></i>
                    Security
                </div>
                <div class="settings-nav-item" onclick="showSection('api-keys')">
                    <i class="fas fa-key mr-3"></i>
                    API Keys
                </div>
                <div class="settings-nav-item" onclick="showSection('notifications')">
                    <i class="fas fa-bell mr-3"></i>
                    Notifications
                </div>
                <div class="settings-nav-item" onclick="showSection('backup')">
                    <i class="fas fa-database mr-3"></i>
                    Backup & Export
                </div>
                <div class="settings-nav-item" onclick="showSection('billing')">
                    <i class="fas fa-credit-card mr-3"></i>
                    Billing
                </div>
                <div class="settings-nav-item" onclick="showSection('advanced')">
                    <i class="fas fa-cogs mr-3"></i>
                    Advanced
                </div>
            </nav>
        </div>
    </div>
    
    <!-- Settings Content -->
    <div class="flex-1 settings-content">
        <!-- General Settings -->
        <div id="general-section" class="settings-section active">
            <h1 class="text-2xl font-bold mb-6">General Settings</h1>
            
            <form method="POST" class="space-y-6">
                <input type="hidden" name="section" value="general">
                
                <!-- Profile Information -->
                <div class="setting-item">
                    <h3 class="text-lg font-semibold mb-4">Profile Information</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="username" class="block text-sm font-medium mb-2">Username</label>
                            <input type="text" 
                                   id="username" 
                                   name="username" 
                                   value="{{ user.username }}"
                                   class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        
                        <div>
                            <label for="email" class="block text-sm font-medium mb-2">Email</label>
                            <input type="email" 
                                   id="email" 
                                   name="email" 
                                   value="{{ user.email }}"
                                   class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </div>
                </div>
                
                <!-- Language & Region -->
                <div class="setting-item">
                    <h3 class="text-lg font-semibold mb-4">Language & Region</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="language" class="block text-sm font-medium mb-2">Language</label>
                            <select id="language" 
                                    name="language" 
                                    class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="en" {% if user.preferences.language == 'en' %}selected{% endif %}>English</option>
                                <option value="es" {% if user.preferences.language == 'es' %}selected{% endif %}>EspaÃ±ol</option>
                                <option value="fr" {% if user.preferences.language == 'fr' %}selected{% endif %}>FranÃ§ais</option>
                                <option value="de" {% if user.preferences.language == 'de' %}selected{% endif %}>Deutsch</option>
                                <option value="zh" {% if user.preferences.language == 'zh' %}selected{% endif %}>ä¸­æ–‡</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="timezone" class="block text-sm font-medium mb-2">Timezone</label>
                            <select id="timezone" 
                                    name="timezone" 
                                    class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="UTC">UTC</option>
                                <option value="US/Pacific">Pacific Time</option>
                                <option value="US/Eastern">Eastern Time</option>
                                <option value="Europe/London">London</option>
                                <option value="Europe/Paris">Paris</option>
                                <option value="Asia/Tokyo">Tokyo</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="btn-cyber px-6 py-3 rounded-lg">
                    <i class="fas fa-save mr-2"></i>
                    Save Changes
                </button>
            </form>
        </div>
        
        <!-- AI Models Settings -->
        <div id="ai-models-section" class="settings-section">
            <h1 class="text-2xl font-bold mb-6">AI Models Configuration</h1>
            
            <div class="setting-item">
                <h3 class="text-lg font-semibold mb-4">Default Model</h3>
                <p class="text-gray-400 mb-4">Select your preferred AI model for chat and analysis</p>
                
                <div class="model-selector">
                    {% for model_id, model_info in models.items() %}
                    <div class="model-card {% if model_id == (user.preferences.model if user.preferences else 'gpt-4o') %}selected{% endif %}"
                         onclick="selectModel('{{ model_id }}')">
                        <div class="flex items-center mb-3">
                            <i class="fas fa-robot text-2xl mr-3 {% if 'gpt' in model_id %}text-blue-400{% else %}text-green-400{% endif %}"></i>
                            <div>
                                <h4 class="font-semibold">{{ model_info.name }}</h4>
                                <p class="text-sm text-gray-400">{{ model_info.provider|title }}</p>
                            </div>
                        </div>
                        
                        <div class="text-xs text-gray-400">
                            {% if 'gpt-4o' == model_id %}
                            Best for complex reasoning and analysis
                            {% elif 'gpt-4o-mini' == model_id %}
                            Fast and efficient for simple tasks  
                            {% elif 'deepseek-chat' == model_id %}
                            Optimized for coding and technical tasks
                            {% elif 'deepseek-reasoner' == model_id %}
                            Advanced reasoning and problem solving
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <input type="hidden" id="selected-model" name="default_model" value="{{ user.preferences.model if user.preferences else 'gpt-4o' }}">
            </div>
            
            <div class="setting-item">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold">Auto-Execute Commands</h3>
                        <p class="text-gray-400 text-sm">Automatically execute safe commands suggested by AI</p>
                    </div>
<div class="toggle-switch {% if user.preferences.auto_execute | default(false) %}active{% endif %}"
     onclick="toggleSetting(this, 'auto_execute')">
</div>

                </div>
            </div>
        </div>
        
        <!-- Appearance Settings -->
        <div id="appearance-section" class="settings-section">
            <h1 class="text-2xl font-bold mb-6">Appearance</h1>
            
            <div class="setting-item">
                <h3 class="text-lg font-semibold mb-4">Theme</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="theme-option p-4 border-2 {% if (user.preferences.theme if user.preferences else 'dark') == 'dark' %}border-blue-500{% else %}border-gray-600{% endif %} rounded-lg cursor-pointer"
                         onclick="selectTheme('dark')">
                        <div class="flex items-center mb-2">
                            <div class="w-6 h-6 bg-gray-900 rounded mr-3"></div>
                            <span class="font-semibold">Dark Theme</span>
                        </div>
                        <p class="text-sm text-gray-400">Perfect for terminal work and low-light environments</p>
                    </div>
                    
                    <div class="theme-option p-4 border-2 {% if (user.preferences.theme if user.preferences else 'dark') == 'light' %}border-blue-500{% else %}border-gray-600{% endif %} rounded-lg cursor-pointer"
                         onclick="selectTheme('light')">
                        <div class="flex items-center mb-2">
                            <div class="w-6 h-6 bg-gray-100 rounded mr-3"></div>
                            <span class="font-semibold">Light Theme</span>
                        </div>
                        <p class="text-sm text-gray-400">Clean and bright for daytime use</p>
                    </div>
                </div>
            </div>
            
            <div class="setting-item">
                <h3 class="text-lg font-semibold mb-4">Accent Color</h3>
                
                <div class="color-picker">
                    <div class="color-option selected" style="background: #00d4ff;" onclick="selectAccentColor('#00d4ff')"></div>
                    <div class="color-option" style="background: #00ff88;" onclick="selectAccentColor('#00ff88')"></div>
                    <div class="color-option" style="background: #ff0080;" onclick="selectAccentColor('#ff0080')"></div>
                    <div class="color-option" style="background: #ffff00;" onclick="selectAccentColor('#ffff00')"></div>
                    <div class="color-option" style="background: #ff4444;" onclick="selectAccentColor('#ff4444')"></div>
                    <div class="color-option" style="background: #8b5cf6;" onclick="selectAccentColor('#8b5cf6')"></div>
                </div>
            </div>
            
            <div class="setting-item">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold">Matrix Background</h3>
                        <p class="text-gray-400 text-sm">Show animated matrix rain effect</p>
                    </div>
                    <div class="toggle-switch active" onclick="toggleSetting(this, 'matrix_bg')"></div>
                </div>
            </div>
        </div>
        
        <!-- Security Settings -->
        <div id="security-section" class="settings-section">
            <h1 class="text-2xl font-bold mb-6">Security Settings</h1>
            
            <div class="setting-item">
                <h3 class="text-lg font-semibold mb-4">Password</h3>
                
                <form class="space-y-4">
                    <div>
                        <label for="current-password" class="block text-sm font-medium mb-2">Current Password</label>
                        <input type="password" 
                               id="current-password" 
                               name="current_password" 
                               class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label for="new-password" class="block text-sm font-medium mb-2">New Password</label>
                        <input type="password" 
                               id="new-password" 
                               name="new_password" 
                               class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label for="confirm-password" class="block text-sm font-medium mb-2">Confirm New Password</label>
                        <input type="password" 
                               id="confirm-password" 
                               name="confirm_password" 
                               class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded transition-colors">
                        Update Password
                    </button>
                </form>
            </div>
            
            <div class="setting-item">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold">Two-Factor Authentication</h3>
                        <p class="text-gray-400 text-sm">Add an extra layer of security to your account</p>
                    </div>
                    <button class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded text-sm transition-colors">
                        Enable 2FA
                    </button>
                </div>
            </div>
            
            <div class="setting-item">
                <h3 class="text-lg font-semibold mb-4">Login History</h3>
                
                <div class="space-y-2">
                    <div class="security-log-item">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="font-medium">Current Session</p>
                                <p class="text-sm text-gray-400">{{ request.remote_addr }} â€¢ Now</p>
                            </div>
                            <span class="text-green-400 text-sm">Active</span>
                        </div>
                    </div>
                    
                    <div class="security-log-item">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="font-medium">Previous Login</p>
                                <p class="text-sm text-gray-400">192.168.1.100 â€¢ 2 hours ago</p>
                            </div>
                            <span class="text-gray-400 text-sm">Ended</span>
                        </div>
                    </div>
                </div>
                
                <button class="mt-4 text-red-400 hover:text-red-300 text-sm">
                    <i class="fas fa-sign-out-alt mr-1"></i>
                    End All Other Sessions
                </button>
            </div>
        </div>
        
        <!-- API Keys Settings -->
        <div id="api-keys-section" class="settings-section">
            <h1 class="text-2xl font-bold mb-6">API Keys</h1>
            
            <div class="setting-item">
                <h3 class="text-lg font-semibold mb-4">OpenAI API Key</h3>
                <p class="text-gray-400 text-sm mb-4">Your personal OpenAI API key for GPT models</p>
                
                <div class="api-key-input">
                    <input type="password" 
                           id="openai-key" 
                           placeholder="sk-..."
                           class="w-full px-4 py-3 pr-12 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono text-sm">
                    <i class="fas fa-eye api-key-toggle" onclick="toggleApiKey('openai-key', this)"></i>
                </div>
                
                <div class="mt-2 flex items-center justify-between">
                    <span class="text-xs text-gray-400">
                        <i class="fas fa-info-circle mr-1"></i>
                        Keys are encrypted and stored securely
                    </span>
                    <button class="text-blue-400 hover:text-blue-300 text-sm">
                        Test Connection
                    </button>
                </div>
            </div>
            
            <div class="setting-item">
                <h3 class="text-lg font-semibold mb-4">DeepSeek API Key</h3>
                <p class="text-gray-400 text-sm mb-4">Your personal DeepSeek API key</p>
                
                <div class="api-key-input">
                    <input type="password" 
                           id="deepseek-key" 
                           placeholder="sk-..."
                           class="w-full px-4 py-3 pr-12 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono text-sm">
                    <i class="fas fa-eye api-key-toggle" onclick="toggleApiKey('deepseek-key', this)"></i>
                </div>
            </div>
            
            <div class="setting-item">
                <h3 class="text-lg font-semibold mb-4">Other API Keys</h3>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">VirusTotal API Key</label>
                        <input type="password" 
                               placeholder="Optional"
                               class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Shodan API Key</label>
                        <input type="password" 
                               placeholder="Optional"
                               class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Notifications Settings -->
        <div id="notifications-section" class="settings-section">
            <h1 class="text-2xl font-bold mb-6">Notifications</h1>
            
            <div class="setting-item">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold">Email Notifications</h3>
                        <p class="text-gray-400 text-sm">Receive updates via email</p>
                    </div>
<div class="toggle-switch {% if user.preferences.auto_execute | default(false) %}active{% endif %}"
     onclick="toggleSetting(this, 'auto_execute')">
</div>

                </div>
            </div>
            
            <div class="setting-item">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold">Scan Completion</h3>
                        <p class="text-gray-400 text-sm">Notify when vulnerability scans complete</p>
                    </div>
                    <div class="toggle-switch active" onclick="toggleSetting(this, 'scan_notifications')"></div>
                </div>
            </div>
            
            <div class="setting-item">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold">Security Alerts</h3>
                        <p class="text-gray-400 text-sm">Important security notifications</p>
                    </div>
                    <div class="toggle-switch active" onclick="toggleSetting(this, 'security_alerts')"></div>
                </div>
            </div>
        </div>
        
        <!-- Backup & Export Settings -->
        <div id="backup-section" class="settings-section">
            <h1 class="text-2xl font-bold mb-6">Backup & Export</h1>
            
            <div class="setting-item">
                <h3 class="text-lg font-semibold mb-4">Auto Backup</h3>
                
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <p class="text-gray-300">Automatically backup your data</p>
                        <p class="text-gray-400 text-sm">Weekly backups of conversations and settings</p>
                    </div>
                    <div class="toggle-switch" onclick="toggleSetting(this, 'auto_backup')"></div>
                </div>
                
                <div class="mt-4">
                    <h4 class="font-semibold mb-2">Recent Backups</h4>
                    <div class="space-y-2">
                        <div class="backup-item">
                            <div class="flex-1">
                                <p class="font-medium">Complete Backup</p>
                                <p class="text-sm text-gray-400">December 15, 2024 â€¢ 2.3 MB</p>
                            </div>
                            <button class="text-blue-400 hover:text-blue-300 text-sm">
                                <i class="fas fa-download mr-1"></i>
                                Download
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="setting-item">
                <h3 class="text-lg font-semibold mb-4">Export Data</h3>
                
                <div class="export-import-area">
                    <i class="fas fa-download text-4xl mb-4 text-blue-400"></i>
                    <h3 class="text-lg font-semibold mb-2">Export Your Data</h3>
                    <p class="text-gray-400 mb-4">Download all your conversations, settings, and activity</p>
                    
                    <div class="flex justify-center space-x-4">
                        <button onclick="exportData('json')" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded transition-colors">
                            <i class="fas fa-file-code mr-2"></i>
                            JSON
                        </button>
                        <button onclick="exportData('csv')" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded transition-colors">
                            <i class="fas fa-file-csv mr-2"></i>
                            CSV
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Billing Settings -->
        <div id="billing-section" class="settings-section">
            <h1 class="text-2xl font-bold mb-6">Billing</h1>
            
            <div class="quota-usage">
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <h3 class="text-lg font-semibold">Current Plan</h3>
                        <p class="text-gray-400">
                            {% if user.is_premium %}Premium Plan{% else %}Free Tier{% endif %}
                        </p>
                    </div>
                    <div class="text-right">
                        <p class="text-2xl font-bold">{% if user.is_premium %}$9.99/mo{% else %}Free{% endif %}</p>
                        <p class="text-sm text-gray-400">{% if user.is_premium %}Billed monthly{% else %}Limited features{% endif %}</p>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
                    <div class="text-center">
                        <p class="text-sm text-gray-400">API Quota</p>
                        <p class="text-xl font-bold">{{ user.api_quota }}</p>
                    </div>
                    <div class="text-center">
                        <p class="text-sm text-gray-400">This Month</p>
                        <p class="text-xl font-bold">$0.00</p>
                    </div>
                    <div class="text-center">
                        <p class="text-sm text-gray-400">Next Billing</p>
                        <p class="text-xl font-bold">{% if user.is_premium %}Jan 15{% else %}N/A{% endif %}</p>
                    </div>
                </div>
            </div>
            
            {% if not user.is_premium %}
            <div class="setting-item">
                <h3 class="text-lg font-semibold mb-4">Upgrade to Premium</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold text-gray-300 mb-3">Free Tier</h4>
                        <ul class="space-y-2 text-sm text-gray-400">
                            <li><i class="fas fa-check text-green-400 mr-2"></i>100 API requests/month</li>
                            <li><i class="fas fa-check text-green-400 mr-2"></i>Basic AI models</li>
                            <li><i class="fas fa-check text-green-400 mr-2"></i>Limited tools access</li>
                            <li><i class="fas fa-times text-red-400 mr-2"></i>No priority support</li>
                        </ul>
                    </div>
                    
                    <div class="border border-yellow-500 rounded-lg p-4 bg-yellow-900/20">
                        <h4 class="font-semibold text-yellow-400 mb-3">Premium Plan</h4>
                        <ul class="space-y-2 text-sm">
                            <li><i class="fas fa-check text-green-400 mr-2"></i>Unlimited API requests</li>
                            <li><i class="fas fa-check text-green-400 mr-2"></i>All AI models</li>
                            <li><i class="fas fa-check text-green-400 mr-2"></i>Full tools access</li>
                            <li><i class="fas fa-check text-green-400 mr-2"></i>Priority support</li>
                            <li><i class="fas fa-check text-green-400 mr-2"></i>Advanced features</li>
                        </ul>
                        
                        <button class="w-full mt-4 bg-gradient-to-r from-yellow-500 to-yellow-600 text-black font-bold py-2 px-4 rounded hover:from-yellow-400 hover:to-yellow-500 transition-all">
                            <i class="fas fa-crown mr-2"></i>
                            Upgrade Now - $9.99/mo
                        </button>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
        
        <!-- Advanced Settings -->
        <div id="advanced-section" class="settings-section">
            <h1 class="text-2xl font-bold mb-6">Advanced Settings</h1>
            
            <div class="setting-item">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold">Developer Mode</h3>
                        <p class="text-gray-400 text-sm">Enable advanced debugging features</p>
                    </div>
                    <div class="toggle-switch" onclick="toggleSetting(this, 'developer_mode')"></div>
                </div>
            </div>
            
            <div class="setting-item">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold">Verbose Logging</h3>
                        <p class="text-gray-400 text-sm">Detailed logs for troubleshooting</p>
                    </div>
                    <div class="toggle-switch" onclick="toggleSetting(this, 'verbose_logging')"></div>
                </div>
            </div>
            
            <div class="setting-item">
                <h3 class="text-lg font-semibold mb-4">Reset Settings</h3>
                <p class="text-gray-400 text-sm mb-4">Restore all settings to default values</p>
                
                <button onclick="resetSettings()" class="bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded transition-colors">
                    <i class="fas fa-undo mr-2"></i>
                    Reset to Defaults
                </button>
            </div>
            
            <!-- Danger Zone -->
            <div class="danger-zone">
                <h3 class="text-lg font-semibold text-red-400 mb-4">
                    <i class="fas fa-exclamation-triangle mr-2"></i>
                    Danger Zone
                </h3>
                
                <div class="space-y-4">
                    <div>
                        <h4 class="font-semibold mb-2">Clear All Data</h4>
                        <p class="text-gray-400 text-sm mb-3">Permanently delete all conversations, history, and settings</p>
                        <button onclick="clearAllData()" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded transition-colors">
                            Clear All Data
                        </button>
                    </div>
                    
                    <hr class="border-red-800">
                    
                    <div>
                        <h4 class="font-semibold mb-2">Delete Account</h4>
                        <p class="text-gray-400 text-sm mb-3">Permanently delete your account and all associated data</p>
                        <button onclick="deleteAccount()" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded transition-colors">
                            Delete Account
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
let currentSection = 'general';
let settingsChanged = false;

document.addEventListener('DOMContentLoaded', function() {
    // Initialize settings
    loadSettings();
    
    // Auto-save settings
    setInterval(autoSave, 30000); // Auto-save every 30 seconds
    
    // Warn before leaving if changes are unsaved
    window.addEventListener('beforeunload', function(e) {
        if (settingsChanged) {
            e.preventDefault();
            e.returnValue = '';
        }
    });
});

function showSection(sectionName) {
    // Hide all sections
    document.querySelectorAll('.settings-section').forEach(section => {
        section.classList.remove('active');
    });
    
    // Remove active from nav items
    document.querySelectorAll('.settings-nav-item').forEach(item => {
        item.classList.remove('active');
    });
    
    // Show selected section
    document.getElementById(`${sectionName}-section`).classList.add('active');
    
    // Add active to nav item
    event.target.classList.add('active');
    
    currentSection = sectionName;
}

function toggleSetting(element, settingName) {
    element.classList.toggle('active');
    settingsChanged = true;
    
    // Update the setting value
    const value = element.classList.contains('active');
    updateSetting(settingName, value);
    
    showNotification(`${settingName.replace('_', ' ')} ${value ? 'enabled' : 'disabled'}`, 'success');
}

function selectModel(modelId) {
    // Remove selected from all model cards
    document.querySelectorAll('.model-card').forEach(card => {
        card.classList.remove('selected');
    });
    
    // Add selected to clicked card
    event.currentTarget.classList.add('selected');
    
    // Update hidden input
    document.getElementById('selected-model').value = modelId;
    
    settingsChanged = true;
    showNotification(`Default model changed to ${modelId}`, 'success');
}

function selectTheme(theme) {
    // Update theme options
    document.querySelectorAll('.theme-option').forEach(option => {
        option.classList.remove('border-blue-500');
        option.classList.add('border-gray-600');
    });
    
    event.currentTarget.classList.remove('border-gray-600');
    event.currentTarget.classList.add('border-blue-500');
    
    // Apply theme immediately
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
    
    settingsChanged = true;
    showNotification(`Theme changed to ${theme}`, 'success');
}

function selectAccentColor(color) {
    // Update color options
    document.querySelectorAll('.color-option').forEach(option => {
        option.classList.remove('selected');
    });
    
    event.currentTarget.classList.add('selected');
    
    // Apply color immediately
    document.documentElement.style.setProperty('--accent-blue', color);
    
    settingsChanged = true;
    showNotification('Accent color updated', 'success');
}

function toggleApiKey(inputId, iconElement) {
    const input = document.getElementById(inputId);
    const icon = iconElement.querySelector('i');
    
    if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
    } else {
        input.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
    }
}

function updateSetting(name, value) {
    // Store setting in localStorage for immediate effect
    const settings = JSON.parse(localStorage.getItem('userSettings') || '{}');
    settings[name] = value;
    localStorage.setItem('userSettings', JSON.stringify(settings));
}

function loadSettings() {
    // Load settings from localStorage
    const settings = JSON.parse(localStorage.getItem('userSettings') || '{}');
    
    // Apply loaded settings
    Object.entries(settings).forEach(([key, value]) => {
        const toggle = document.querySelector(`[onclick*="${key}"]`);
        if (toggle && toggle.classList.contains('toggle-switch')) {
            if (value) {
                toggle.classList.add('active');
            } else {
                toggle.classList.remove('active');
            }
        }
    });
}

function autoSave() {
    if (settingsChanged) {
        // Implementation would save settings to server
        console.log('Auto-saving settings...');
        settingsChanged = false;
    }
}

function exportData(format) {
    const data = {
        profile: {
            username: '{{ user.username }}',
            email: '{{ user.email }}',
            is_premium: {{ user.is_premium|lower }},
            created_at: '{{ user.created_at }}'
        },
        settings: JSON.parse(localStorage.getItem('userSettings') || '{}'),
        export_date: new Date().toISOString()
    };
    
    let content, filename, mimeType;
    
    if (format === 'json') {
        content = JSON.stringify(data, null, 2);
        filename = `hackinggpt_settings_${new Date().toISOString().split('T')[0]}.json`;
        mimeType = 'application/json';
    } else if (format === 'csv') {
        // Convert to CSV format
        content = 'Setting,Value\n';
        Object.entries(data.settings).forEach(([key, value]) => {
            content += `"${key}","${value}"\n`;
        });
        filename = `hackinggpt_settings_${new Date().toISOString().split('T')[0]}.csv`;
        mimeType = 'text/csv';
    }
    
    const blob = new Blob([content], { type: mimeType });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    a.click();
    window.URL.revokeObjectURL(url);
    
    showNotification(`Settings exported as ${format.toUpperCase()}`, 'success');
}

function resetSettings() {
    if (!confirm('Reset all settings to default values? This action cannot be undone.')) {
        return;
    }
    
    // Clear localStorage
    localStorage.removeItem('userSettings');
    
    // Reset all toggles
    document.querySelectorAll('.toggle-switch').forEach(toggle => {
        toggle.classList.remove('active');
    });
    
    // Reset theme
    document.documentElement.setAttribute('data-theme', 'dark');
    
    // Reset accent color
    document.documentElement.style.setProperty('--accent-blue', '#00d4ff');
    
    showNotification('Settings reset to defaults', 'success');
    setTimeout(() => location.reload(), 1000);
}

function clearAllData() {
    const confirmation = prompt('Type "CLEAR ALL DATA" to confirm:');
    
    if (confirmation !== 'CLEAR ALL DATA') {
        showNotification('Data clear cancelled', 'info');
        return;
    }
    
    if (!confirm('This will permanently delete all your conversations, history, and settings. Are you sure?')) {
        return;
    }
    
    // Implementation would clear all user data
    showNotification('All data cleared successfully', 'success');
    setTimeout(() => location.reload(), 2000);
}

function deleteAccount() {
    const confirmation = prompt('Type "DELETE ACCOUNT" to confirm account deletion:');
    
    if (confirmation !== 'DELETE ACCOUNT') {
        showNotification('Account deletion cancelled', 'info');
        return;
    }
    
    if (!confirm('This will permanently delete your account and all data. This action cannot be undone. Are you absolutely sure?')) {
        return;
    }
    
    // Implementation would delete account
    showNotification('Account deletion initiated. You will be logged out shortly.', 'warning');
    setTimeout(() => {
        window.location.href = '/logout';
    }, 3000);
}

// Form submissions
document.addEventListener('submit', async function(e) {
    if (e.target.tagName === 'FORM') {
        e.preventDefault();
        
        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData);
        
        try {
            const response = await fetch('/settings', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });
            
            if (response.ok) {
                showNotification('Settings saved successfully', 'success');
                settingsChanged = false;
            } else {
                showNotification('Failed to save settings', 'error');
            }
        } catch (error) {
            showNotification('Error saving settings', 'error');
        }
    }
});

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
    // Ctrl+S to save
    if (e.ctrlKey && e.key === 's') {
        e.preventDefault();
        if (settingsChanged) {
            autoSave();
            showNotification('Settings saved', 'success');
        }
    }
});
</script>
{% endblock %}